{% extends "base.html" %}
{% load adminmedia %}
{% load my_filters %}

{% block title %}Документы захоронения{% endblock %}

{% block scripts %}
{{ form.media }}
<link rel="stylesheet" href="/media/css/ui-lightness/jquery-ui-1.8.6.custom.css" type="text/css" />
<script type="text/javascript" src="/media/js/jquery-1.4.4.min.js"></script>
<script type="text/javascript" src="/media/js/jquery-ui-1.8.6.custom.min.js"></script>
<script type="text/javascript" src="/admin_media/js/admin/RelatedObjectLookups.js"></script>
<script type="text/javascript">
    window.__admin_media_prefix__ = "{% filter escapejs %}{% admin_media_prefix %}{% endfilter %}";

    $(function() {
        function setupSums() {
            $('span.sum').each(function() {
                var count = parseFloat($(this).parents('tr').find('input[name$=count]').val());
                var price = parseFloat($(this).parents('tr').find('input[name$=price]').val());
                $(this).text(price * count);
            })
        }
        $('input[id$=price],input[id$=count]').change(setupSums);
        setupSums();
    })
</script>
{% endblock %}

{% block content %}
    <div id="free_form">
    <form action="" method="post" enctype="multipart/form-data">
        {{ form.non_field_errors }}
        <table width="800">
            <tr>
                <td colspan="6">
                    <h2>Счет-заказ</h2>
                </td>
            </tr>
            <tr>
                <td id="free_form"></td>
                <td id="free_form">Позиция</td>
                <td>Ед. изм.</td>
                <td>Кол-во</td>
                <td>Цена</td>
                <td>Стоимость</td>
            </tr>
            {{ positions_fs.management_form }}
            {% for form in positions_fs.forms %}
                <tr>
                    <td>
                        {{ form.order_product }}
                        {{ form.active }}{{ form.active.errors }}
                    </td>
                    <td>{{ form.initial.order_product }}</td>
                    <td>{{ form.initial.order_product.measure }}</td>
                    <td>{{ form.count }}{{ form.count.errors }}</td>
                    <td>{{ form.price }}{{ form.price.errors }}</td>
                    <td><span class="sum"></span></td>
                </tr>
            {% endfor %}
            <tr>
                <td colspan="6">
                    {{ payment_form.payment_type.label_tag }}
                    {{ payment_form.payment_type }}{{ payment_form.payment_type.errors }}
                </td>
            </tr>
            <tr>
                <td colspan="6">
                    <h2>Наряды</h2>
                </td>
            </tr>
            <tr>
                <td colspan="3">
                    {{ print_form.catafalque }}{{ print_form.catafalque.errors }}
                    {{ print_form.catafalque.label_tag }}
                </td>
                <td colspan="3">
                    {{ print_form.graving }}{{ print_form.graving.errors }}
                    {{ print_form.graving.label_tag }}
                </td>
            </tr>
        <!--
            <tr>
                <td colspan="6">
                    <h2>Справка</h2>
                </td>
            </tr>
            <tr>
                <td colspan="6">
                </td>
            </tr>
        -->
        </table>
        <br />
        <input type="submit" value="Распечатать документы">
        <input type="submit" name="receipt" value="Распечатать справку">
        <input type="submit" name="dogovor" value="Распечатать договор отв.">
        <input type="reset" value="Отмена">
    </form>
    </div>

{% endblock %}
