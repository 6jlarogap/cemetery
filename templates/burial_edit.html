{% extends "base.html" %}
{% load adminmedia %}
{% load my_filters %}
{% block title %}Редактирование захоронения{% endblock %}
{% block scripts %}
{{ form.media }}
<link rel="stylesheet" href="/media/css/ui-lightness/jquery-ui-1.8.6.custom.css" type="text/css" />
<link rel="stylesheet" href="/media/css/jquery-ui-timepicker.css?v=0.2.3" type="text/css" />
<script type="text/javascript" src="/media/js/jquery-1.4.4.min.js"></script>
<script type="text/javascript" src="/media/js/jquery-ui-1.8.6.custom.min.js"></script>
<script type="text/javascript" src="/admin_media/js/admin/RelatedObjectLookups.js"></script>
    <script type="text/javascript" src="/media/js/jquery.ui.timepicker.js?v=0.2.3"></script>
<script type="text/javascript">
    window.__admin_media_prefix__ = "{% filter escapejs %}{% admin_media_prefix %}{% endfilter %}";
</script>
<script type="text/javascript" charset="utf-8">
//Первоначальное заполнение списка услуг.

function updateResponsible() {
    if ($('#id_responsible_myself:checked').length == 0) {
        $('.responsible_myself').show()
    } else {
        $('.responsible_myself').hide()
    }
}

function updateOPF() {
    var cls = 'opf_' + $('[name=opf]:checked').val();
    $('.opf_fizik, .opf_yurik').hide();
    $('.'+cls).show()
}

$(function(){
    var CALENDAR_ICON = '/admin_media/img/admin/icon_calendar.gif';
    var CLOCK_IMAGE = '/admin_media/img/admin/icon_clock.gif';

    $.datepicker.setDefaults($.datepicker.regional['ru']);
    $('input[name$=date],input[name$=expire]').css('width', '100px').datepicker({
        dateFormat: 'dd.mm.yy',
        changeMonth: true,
        changeYear: true,
        monthNamesShort: ['Янв','Фев','Март','Апрель','Май','Июнь','Июль','Авг','Сен','Окт','Ноя','Дек'],
        dayNamesMin: ['Пн', 'Вт', 'Ср', 'Чт', 'Пт', 'Сб', 'Вс'],
        showOn: "both",
        buttonImage: CALENDAR_ICON,
        buttonImageOnly: true
    });
    $('input[name$=time]').each(function() {
        var btn_id = $(this).attr('id') + '_button';
        var img = $('<img src="'+CLOCK_IMAGE+'"/>').attr('id', btn_id).insertAfter($(this));
        $(this).css('width', '100px').timepicker({
            showOn: "both",
            button: "#" + btn_id,
            hourText: 'Ч',
            minuteText: 'М',
            showPeriodLabels: false,
            minutes: {
                starts: 0,
                ends: 45,
                interval: 15
            },
            hours: {
                starts: 8,
                ends: 19,
                interval: 1
            }
        });
    });

    $(':input,textarea,select').each(function(i, el) {
        $(el).attr('tabIndex', i+1);
    })

    $('#id_responsible_myself').change(updateResponsible);
    updateResponsible();

    $('#id_opf_0, #id_opf_1').change(updateOPF);
    updateOPF();

    $("#id_burial_date, #id_birth_date, #id_death_date").focus(function(){
     this.select();
     });

     $("#id_customer_last_name").focus(function(){
         if ($(this).val()=="{{ UNKNOWN_NAME }}")
         {$(this).val("");}
         });

     $("#id_customer_last_name").focusout(function(){
         if ($(this).val()=="")
         {$(this).val("{{ UNKNOWN_NAME }}");}
         });

    var initial_operation = $("#id_operation").val();
    $.getJSON("/getoper/",{id: $("#id_cemetery").val(), ajax: 'true'}, function(j){
      var options = '';
      for (var i = 0; i < j.length; i++) {
        if (j[i].optionValue == $("#id_hoperation").val())
        { options += '<option selected value="' + j[i].optionValue + '">' + j[i].optionDisplay + '</option>'; }
        else
        { options += '<option value="' + j[i].optionValue + '">' + j[i].optionDisplay + '</option>'; }
      }
      $("#id_operation").html(options);
        $("#id_operation").val(initial_operation);
    });
    });
$(function(){
//   $("#id_country").change(function(){
//            $("#id_region").val("");
//            $("#id_city").val("");
//            $("#id_street").val("");
//        });
//   $("#id_region").change(function(){
//            $("#id_city").val("");
//            $("#id_street").val("");
//        });
//   $("#id_city").change(function(){
//            $("#id_street").val("");
//        });
  // Обработчик изменения выбранной услуги.
  $("#id_operation").change(function(){
    $("#id_hoperation").val($("#id_operation").val());
  });
  // Обработчик изменения выбранного кладбища.
  $("#id_cemetery").change(function(){
    $.getJSON("/getoper/",{id: $(this).val(), ajax: 'true'}, function(j){
      var options = '';
      for (var i = 0; i < j.length; i++) {
        if (j[i].optionValue == $("#id_hoperation").val())
        {
            options += '<option selected value="' + j[i].optionValue + '">' + j[i].optionDisplay + '</option>';
//            $("#id_hoperation").val(j[i].optionValue);
//            s = 1;
        }
        else
        {
            options += '<option value="' + j[i].optionValue + '">' + j[i].optionDisplay + '</option>';
        }
//        if (s == 0)
//          {
//            options = '<option value="0">----------------</option>' + options;
//          }
      }
      $("#id_operation").html(options);
      $("#id_area").val("");
      $("#id_row").val("");
      $("#id_seat").val("");
    });
  });

  // Обработчик изменения выбранного кладбища.
  $("#id_organization").change(function(){
    $.getJSON("/getagents/", {id: $(this).val(), ajax: 'true'}, function(j){
      var options = '';
      for (var i = 0; i < j.length; i++) {
        if (j[i].optionValue == $("#id_hoperation").val())
        {
            options += '<option selected value="' + j[i].optionValue + '">' + j[i].optionDisplay + '</option>';
        }
        else
        {
            options += '<option value="' + j[i].optionValue + '">' + j[i].optionDisplay + '</option>';
        }
      }
      $("#id_operation").html(options);
    });
  });

  // Обработчик изменения выбранного кладбища.
  $("#id_organization").change(function(){
    $.getJSON("/getagents/", {id: $(this).val(), ajax: 'true'}, function(j){
      var options = '';
      for (var i = 0; i < j.length; i++) {
        if (j[i].optionValue == $("#id_agent").val())
        {
            options += '<option selected value="' + j[i].optionValue + '">' + j[i].optionDisplay + '</option>';
        }
        else
        {
            options += '<option value="' + j[i].optionValue + '">' + j[i].optionDisplay + '</option>';
        }
      }
      $("#id_agent").html(options);
        $("#id_agent").next('a').attr('href', "/admin/common/organization/"+$("#id_organization").val()+"/");
    });
  });

    $('#id_agent').change(updateDover);
    updateDover();

    $("#id_organization").after('<a href="/admin/common/organization/add/" class="add-another" id="add_id_organization" onclick="return showAddAnotherPopup(this);">создать</a>')
    $("#id_certificate-zags").after('<a href="/admin/common/zags/add/" class="add-another" id="add_id_certificate-zags" onclick="return showAddAnotherPopup(this);">создать</a>')
    $("#id_id-id_type").after('<a href="/admin/common/iddocumenttype/add/" class="add-another" id="add_id_id-id_type" onclick="return showAddAnotherPopup(this);">создать</a>')
    $("#id_agent").after('<a href="/admin/common/organization/"+$("#id_organization").val()+"/" target="_blank">создать</a>')

   //автодополнение страны.
   $("#id_country").autocomplete({
        source: "/getcountries/",
        minLength: 1,
        delay: 100,
    });

   //автодополнение региона.
   $("#id_region").autocomplete({
        source: "/getregions/",
        minLength: 2,
        delay: 100,
        select: function(event, ui) {
            $("#id_region").val(ui.item.value.split("/")[0]);
            $("#id_country").val(ui.item.value.split("/")[1]);
            return false;
       },
       focus: function(event, ui) {
            $("#id_region").val(ui.item.value.split("/")[0]);
//            $("#id_country").val(ui.item.value.split("/")[1]);
            return false;
       }
   });
   //автодополнение нас. пункта.
   $("#id_city").autocomplete({
        source: "/getcities/",
        minLength: 2,
        delay: 100,
        select: function(event, ui) {
            $("#id_city").val(ui.item.value.split("/")[0]);
            $("#id_region").val(ui.item.value.split("/")[1]);
            $("#id_country").val(ui.item.value.split("/")[2]);
            return false;
       },
       focus: function(event, ui) {
            $("#id_city").val(ui.item.value.split("/")[0]);
//            $("#id_region").val(ui.item.value.split("/")[1]);
//            $("#id_country").val(ui.item.value.split("/")[2]);
            return false;
       }

    });
   //автодополнение улицы.
   $("#id_street").autocomplete({
        source: "/getstreets/",
        minLength: 2,
        delay: 100,
        select: function(event, ui) {
            $("#id_street").val(ui.item.value.split("/")[0]);
            $("#id_city").val(ui.item.value.split("/")[1]);
            $("#id_region").val(ui.item.value.split("/")[2]);
            $("#id_country").val(ui.item.value.split("/")[3]);
            return false;
       },
       focus: function(event, ui) {
            $("#id_street").val(ui.item.value.split("/")[0]);
//            $("#id_city").val(ui.item.value.split("/")[1]);
//            $("#id_region").val(ui.item.value.split("/")[2]);
//            $("#id_country").val(ui.item.value.split("/")[3]);
            return false;
       }

    });
})
</script>
{%  endblock %}
{% block content %}
    <div id="free_form">
    <form action="" method="post" enctype="multipart/form-data">
        {{ form.errors }}
        {{ form.non_field_errors }}
        {{ location_form.non_field_errors }}
        {{ registration_form.non_field_errors }}
        {{ certificate_form.non_field_errors }}
        {{ responsible_form.non_field_errors }}
        <table width="800">
            <tr>
                <td  id="free_form">{{ form.account_book_n.label_tag }}</td>
                <td  id="free_form">{{ form.burial_date.label_tag }}</td>
                <td >
                    {{ form.exhumated_date.label_tag }}
                </td>
            </tr>
            <tr>
                {% if user|in_group:"edit_burial" %}
                    <td >{{ form.account_book_n.errors }}{{ form.account_book_n }}</td>
                    <td >{{ form.burial_date.errors }}{{ form.burial_date }}<br/>{{ form.burial_time.errors }}{{ form.burial_time }}</td>
                    <td >
                        {{ form.exhumated_date.errors }}{{ form.exhumated_date }} <br/>
                        {% if form.initial.exhumated_date %}
                            <label><input type="checkbox" name="disable_exhumation" value="go" {% if request.POST.disable_exhumation %}checked="1"{% endif %} /> отменить</label>
                        {% endif %}
                    </td>
                {% else %}
                    <td >{{ burial.account_book_n }}</td>
                    <td >{{ burial.date_fact|date:"d.m.Y" }}</td>
                    <td >{{ burial.exhumated_date|date:"d.m.Y" }}</td>
                {% endif %}
            </tr>
            <tr>
                <td  class="free_form">{{ form.birth_date.label_tag }}</td>
                <td  class="free_form">{{ form.death_date.label_tag }}</td>
                <td >{{ certificate_form.zags.label_tag }}</td>
            </tr>
            <tr>
                <td >{{ form.birth_date.errors }}{{ form.birth_date }}</td>
                <td >{{ form.death_date.errors }}{{ form.death_date }}</td>
                <td >{{ certificate_form.zags.errors }}{{ certificate_form.zags }}</td>
            </tr>
            <tr>
                <td  class="free_form">{{ certificate_form.series.label_tag }}</td>
                <td  class="free_form">{{ certificate_form.release_date.label_tag }}</td>
                <td >{{ certificate_form.s_number.label_tag }}</td>
            </tr>
            <tr>
                <td >{{ certificate_form.series.errors }}{{ certificate_form.series }}</td>
                <td >{{ certificate_form.release_date.errors }}{{ certificate_form.release_date }}</td>
                <td >{{ certificate_form.s_number.errors }}{{ certificate_form.s_number }}</td>
            </tr>
            <tr>
                <td  id="free_form">{{ form.last_name.label_tag }}</td>
                <td  id="free_form">{{ form.first_name.label_tag }}</td>
                <td  id="free_form">{{ form.patronymic.label_tag }}</td>
            </tr>
            <tr>
                {% if user|in_group:"edit_burial" %}
                    <td  id="free_form">{{ form.last_name.errors }}{{ form.last_name }}</td>
                    <td  id="free_form">{{ form.first_name.errors }}{{ form.first_name }}</td>
                    <td  id="free_form">{{ form.patronymic.errors }}{{ form.patronymic }}</td>
                {% else %}
                    <td  id="free_form">{{ burial.person.last_name }}</td>
                    <td  id="free_form">{{ burial.person.first_name }}</td>
                    <td  id="free_form">{{ burial.person.patronymic }}</td>
                {% endif %}
            </tr>

            <tr>
                <td class="free_form">{{ form.opf.label_tag }}</td>
                <td class="free_form opf_fizik">{{ form.responsible_myself.label_tag }}</td>
                <td class="free_form opf_yurik">{{ form.organization.label_tag }}</td>
                <td class="free_form opf_yurik">{{ form.agent_director.label_tag }}</td>
                <td class="free_form opf_yurik">{{ form.agent.label_tag }}</td>
            </tr>
            <tr>
                <td class="free_form">{{ form.opf.errors }}{{ form.opf }}</td>
                <td class="free_form opf_fizik">{{ form.responsible_myself.errors }}{{ form.responsible_myself }}</td>
                <td class="free_form opf_yurik">{{ form.organization.errors }}{{ form.organization }}</td>
                <td class="free_form opf_yurik">{{ form.agent_director.errors }}{{ form.agent_director }}</td>
                <td class="free_form opf_yurik">{{ form.agent.errors }}{{ form.agent }}</td>
            </tr>
            <tr class="opf_fizik">
                <td class="free_form">{{ id_form.id_type.label_tag }}</td>
                <td class="free_form">{{ id_form.series.label_tag }}</td>
                <td class="free_form">{{ id_form.number.label_tag }}</td>
            </tr>
            <tr class="opf_fizik">
                <td class="free_form">{{ id_form.id_type.errors }}{{ id_form.id_type }}</td>
                <td class="free_form">{{ id_form.series.errors }}{{ id_form.series }}</td>
                <td class="free_form">{{ id_form.number.errors }}{{ id_form.number }}</td>
            </tr>
            <tr class="opf_fizik">
                <td class="free_form">{{ id_form.who.label_tag }}</td>
                <td class="free_form">{{ id_form.when.label_tag }}</td>
            </tr>
            <tr class="opf_fizik">
                <td class="free_form">{{ id_form.who.errors }}{{ id_form.who }}</td>
                <td class="free_form">{{ id_form.when.errors }}{{ id_form.when }}</td>
            </tr>
            <tr class="opf_yurik">
                <td class="free_form">{{ form.dover_number.label_tag }}</td>
                <td class="free_form">{{ form.dover_date.label_tag }}</td>
                <td class="free_form">{{ form.dover_expire.label_tag }}</td>
            </tr>
            <tr class="opf_yurik">
                <td class="free_form">{{ form.dover_number.errors }}{{ form.dover_number }}</td>
                <td class="free_form">{{ form.dover_date.errors }}{{ form.dover_date }}</td>
                <td class="free_form">{{ form.dover_expire.errors }}{{ form.dover_expire }}</td>
            </tr>

            <tr>
                <td  id="free_form">{{ form.cemetery.label_tag }}</td>
                <td  id="free_form">{{ form.operation.label_tag }}</td>
                <td >&nbsp;</td>
            </tr>
            <tr>
                {% if user|in_group:"edit_burial" %}
                    <td  id="free_form">{{ form.cemetery.errors }}{{ form.cemetery }}</td>
                    <td  id="free_form">{{ form.operation.errors }}{{ form.operation }}{{ form.hoperation.errors }}{{ form.hoperation }}</td>
                    <td >&nbsp;</td>
                {% else %}
                    <td  id="free_form">{{ burial.product.place.cemetery.name }}</td>
                    <td  id="free_form">{{ burial.operation.op_type }}</td>
                    <td >&nbsp;</td>
                {% endif %}
            </tr>
            <tr>
                <td  id="free_form">{{ form.area.label_tag }}</td>
                <td  id="free_form">{{ form.row.label_tag }}</td>
                <td  id="free_form">{{ form.seat.label_tag }}</td>
                <td  id="free_form">{{ form.rooms.label_tag }}</td>
            </tr>
            <tr>
                {% if user|in_group:"edit_burial" %}
                    <td  id="free_form">{{ form.area.errors }}{{ form.area }}</td>
                    <td  id="free_form">{{ form.row.errors }}{{ form.row }}</td>
                    <td  id="free_form">{{ form.seat.errors }}{{ form.seat }}</td>
                    <td  id="free_form">
                        {{ form.rooms.errors }}{{ form.rooms }}<br/>
                        {{ burial.product.place.rooms_occupied }} занято/{{ burial.product.place.rooms_free }} своб.
                    </td>
                {% else %}
                    <td  id="free_form">{{ burial.product.place.area }}</td>
                    <td  id="free_form">{{ burial.product.place.row }}</td>
                    <td  id="free_form">{{ burial.product.place.seat }}</td>
                {% endif %}
            </tr>
            <tr>
                <td  id="free_form">{{ form.customer_last_name.label_tag }}</td>
                <td  id="free_form">{{ form.customer_first_name.label_tag }}</td>
                <td  id="free_form">{{ form.customer_patronymic.label_tag }}</td>
            </tr>
            <tr>
                {% if user|in_group:"edit_burial" %}
                    <td  id="free_form">{{ form.customer_last_name.errors }}{{ form.customer_last_name }}</td>
                    <td  id="free_form">{{ form.customer_first_name.errors }}{{ form.customer_first_name }}</td>
                    <td  id="free_form">{{ form.customer_patronymic.errors }}{{ form.customer_patronymic }}</td>
                {% else %}
                    <td  id="free_form">{{ burial.customer.person.last_name }}</td>
                    <td  id="free_form">{{ burial.customer.person.first_name }}</td>
                    <td  id="free_form">{{ burial.customer.person.patronymic }}</td>
                {% endif %}
            </tr>

            <!-- LOCATION -->
            <tr>
                <td colspan="3"><h2>Адрес проживания заказчика (для связи)</h2></td>
            </tr>
            <tr>
                <td  class="free_form">{{ location_form.post_index.label_tag }}</td>
                <td  class="free_form">{{ location_form.post_index.errors }}{{ location_form.post_index }}</td>
                <td >&nbsp;</td>
            </tr>
            <tr>
                <td class="free_form">{{ location_form.street.label_tag }}</td>
                <td class="free_form">{{ location_form.city.label_tag }}</td>
                <td class="free_form">{{ location_form.region.label_tag }}</td>
                <td class="free_form">{{ location_form.country.label_tag }}</td>
            </tr>
            <tr>
                <td class="free_form">{{ location_form.street.errors }}{{ location_form.street }}</td>
                <td class="free_form">{{ location_form.city.errors }}{{ location_form.city }}</td>
                <td class="free_form">{{ location_form.region.errors }}{{ location_form.region }}</td>
                <td class="free_form">{{ location_form.country.errors }}{{ location_form.country }}</td>
            </tr>
            <tr>
                <td class="free_form">{{ location_form.new_street.label_tag }}</td>
                <td class="free_form">{{ location_form.new_city.label_tag }}</td>
                <td class="free_form">{{ location_form.new_region.label_tag }}</td>
                <td>{{ location_form.new_country.label_tag }}</td>
                <td>&nbsp;</td>
            </tr>
            <tr>
                <td class="free_form">{{ location_form.new_street }}</td>
                <td class="free_form">{{ location_form.new_city }}</td>
                <td class="free_form">{{ location_form.new_region }}</td>
                <td>{{ location_form.new_country }}</td>
            </tr>
            <tr>
                <td class="free_form">{{ location_form.house.label_tag }}</td>
                <td class="free_form">{{ location_form.block.label_tag }}</td>
                <td class="free_form">{{ location_form.building.label_tag }}</td>
                <td class="free_form">{{ location_form.flat.label_tag }}</td>
            </tr>
            <tr>
                <td class="free_form">{{ location_form.house.errors }}{{ location_form.house }}</td>
                <td class="free_form">{{ location_form.block.errors }}{{ location_form.block }}</td>
                <td class="free_form">{{ location_form.building.errors }}{{ location_form.building }}</td>
                <td class="free_form">{{ location_form.flat.errors }}{{ location_form.flat }}</td>
            </tr>
            <!-- /LOCATION -->

            <!-- REGISTRATION -->
            <tr>
                <td colspan="3">
                    <h2>Адрес прописки усопшего</h2>
                </td>
            </tr>
            <tr>
                <td  class="free_form">{{ registration_form.post_index.label_tag }}</td>
                <td  class="free_form">{{ registration_form.post_index.errors }}{{ registration_form.post_index }}</td>
                <td >&nbsp;</td>
            </tr>
            <tr>
                <td class="free_form">{{ registration_form.street.label_tag }}</td>
                <td class="free_form">{{ registration_form.city.label_tag }}</td>
                <td class="free_form">{{ registration_form.region.label_tag }}</td>
                <td class="free_form">{{ registration_form.country.label_tag }}</td>
            </tr>
            <tr>
                <td class="free_form">{{ registration_form.street.errors }}{{ registration_form.street }}</td>
                <td class="free_form">{{ registration_form.city.errors }}{{ registration_form.city }}</td>
                <td class="free_form">{{ registration_form.region.errors }}{{ registration_form.region }}</td>
                <td class="free_form">{{ registration_form.country.errors }}{{ registration_form.country }}</td>
            </tr>
            <tr>
                <td class="free_form">{{ registration_form.new_street.label_tag }}</td>
                <td class="free_form">{{ registration_form.new_city.label_tag }}</td>
                <td class="free_form">{{ registration_form.new_region.label_tag }}</td>
                <td>{{ registration_form.new_country.label_tag }}</td>
                <td>&nbsp;</td>
            </tr>
            <tr>
                <td class="free_form">{{ registration_form.new_street }}</td>
                <td class="free_form">{{ registration_form.new_city }}</td>
                <td class="free_form">{{ registration_form.new_region }}</td>
                <td>{{ registration_form.new_country }}</td>
            </tr>
            <tr>
                <td class="free_form">{{ registration_form.house.label_tag }}</td>
                <td class="free_form">{{ registration_form.block.label_tag }}</td>
                <td class="free_form">{{ registration_form.building.label_tag }}</td>
                <td class="free_form">{{ registration_form.flat.label_tag }}</td>
            </tr>
            <tr>
                <td class="free_form">{{ registration_form.house.errors }}{{ registration_form.house }}</td>
                <td class="free_form">{{ registration_form.block.errors }}{{ registration_form.block }}</td>
                <td class="free_form">{{ registration_form.building.errors }}{{ registration_form.building }}</td>
                <td class="free_form">{{ registration_form.flat.errors }}{{ registration_form.flat }}</td>
            </tr>
            <!-- /REGISTRATION -->


            <!-- responsible -->
            <tr class="responsible_myself">
                <td colspan="3"><h2>Ответственное лицо</h2></td>
            </tr>
            <tr class="responsible_myself">
                <td class="free_form">{{ form.responsible_last_name.label_tag }}</td>
                <td class="free_form">{{ form.responsible_first_name.label_tag }}</td>
                <td class="free_form">{{ form.responsible_patronymic.label_tag }}</td>
            </tr>
            <tr class="responsible_myself">
                <td class="free_form">{{ form.responsible_last_name.errors }}{{ form.responsible_last_name }}</td>
                <td class="free_form">{{ form.responsible_first_name.errors }}{{ form.responsible_first_name }}</td>
                <td class="free_form">{{ form.responsible_patronymic.errors }}{{ form.responsible_patronymic }}</td>
            </tr>

            <tr class="responsible_myself">
                <td class="free_form">{{ responsible_form.post_index.label_tag }}</td>
                <td class="free_form">{{ responsible_form.post_index.errors }}{{ responsible_form.post_index }}</td>
                <td >&nbsp;</td>
            </tr>
            <tr class="responsible_myself">
                <td class="free_form">{{ responsible_form.street.label_tag }}</td>
                <td class="free_form">{{ responsible_form.city.label_tag }}</td>
                <td class="free_form">{{ responsible_form.region.label_tag }}</td>
                <td class="free_form">{{ responsible_form.country.label_tag }}</td>
            </tr>
            <tr class="responsible_myself">
                <td class="free_form">{{ responsible_form.street.errors }}{{ responsible_form.street }}</td>
                <td class="free_form">{{ responsible_form.city.errors }}{{ responsible_form.city }}</td>
                <td class="free_form">{{ responsible_form.region.errors }}{{ responsible_form.region }}</td>
                <td class="free_form">{{ responsible_form.country.errors }}{{ responsible_form.country }}</td>
            </tr>
            <tr class="responsible_myself">
                <td class="free_form">{{ responsible_form.new_street.label_tag }}</td>
                <td class="free_form">{{ responsible_form.new_city.label_tag }}</td>
                <td class="free_form">{{ responsible_form.new_region.label_tag }}</td>
                <td>{{ responsible_form.new_country.label_tag }}</td>
                <td>&nbsp;</td>
            </tr>
            <tr class="responsible_myself">
                <td class="free_form">{{ responsible_form.new_street }}</td>
                <td class="free_form">{{ responsible_form.new_city }}</td>
                <td class="free_form">{{ responsible_form.new_region }}</td>
                <td>{{ responsible_form.new_country }}</td>
            </tr>
            <tr class="responsible_myself">
                <td class="free_form">{{ responsible_form.house.label_tag }}</td>
                <td class="free_form">{{ responsible_form.block.label_tag }}</td>
                <td class="free_form">{{ responsible_form.building.label_tag }}</td>
                <td class="free_form">{{ responsible_form.flat.label_tag }}</td>
            </tr>
            <tr class="responsible_myself">
                <td class="free_form">{{ responsible_form.house.errors }}{{ responsible_form.house }}</td>
                <td class="free_form">{{ responsible_form.block.errors }}{{ responsible_form.block }}</td>
                <td class="free_form">{{ responsible_form.building.errors }}{{ responsible_form.building }}</td>
                <td class="free_form">{{ responsible_form.flat.errors }}{{ responsible_form.flat }}</td>
            </tr>
            <!-- /responsible -->

            <tr>
                {{ phoneset }}
            </tr>
        </table>
    <h3>Комментарии:</h3>
        {% for c in burial.ordercomments_set.all %}
        <!--            <b>{{ forloop.counter }}</b> {{ c.comment }} <a href="/admin/common/ordercomments/{{ c.uuid }}/" target="_blank">редактировать</a><br />-->
            <b>{{ forloop.counter }}</b> {{ c.comment }} <a href="/ordercomment/{{ c.uuid }}/" target="_self">редактировать</a><br />
            <small><b>{{ c.creator }}</b>, {{ c.date_of_creation }}</small><br /><br />
        {%  endfor %}
        <br />
        <small>Добавить новый:</small>
        <br />
        {{ form.comment.errors }}{{ form.comment }}
    <h3>Файлы:</h3>
        {% for f in burial.orderfiles_set.all %}
            <b>{{ forloop.counter }} &nbsp; {{ f.ofile.name }}</b>
{#            <img src="{{ f.ofile.thumbnail.url }}">#}
            <a href="/media/{{ f.ofile }}">открыть</a>
            <a href="/orderfile/delete/{{ burial.uuid }}/{{ f.uuid }}/">удалить</a>
            <br />
            <small>Комментарий к файлу:</small> <i>{{ f.comment }}</i>
            <br />
            <a href="/orderfilecomment/{{ f.uuid }}/" target="_self">редактировать комментарий</a>
            <br />
            <small><i>{{ f.creator }}</i>, {{ f.date_of_creation }}</small><br /><br />
        {%  endfor %}
        <small>Добавить новый (до 5 Mb):</small>
        <br />
        {{ form.file1.errors }}{{ form.file1 }}<br />
        {{ form.file1_comment.errors }}{{ form.file1_comment }}
        <br />
        <br />
        {% if user|in_group:"edit_bur_in_adm" %}
            {{ form.in_trash.label_tag }}{{ form.in_trash }}
        {% endif %}
        <br />
        <a href="{% url add_burial %}?place={{ burial.product.place.pk }}" target="_blank">Добавить родственное</a>
        <a href="{% url print_burial burial.pk %}" target="_blank">Документы</a>
        <br />
        <input type="submit" value="Сохранить"  tabindex="22">
        <button type="button" onclick="top.location.href='{{ request.path }}';" tabindex="23">Отмена</button>
    </form>
    </div>
    <br />
    <br />
    <br />
    <a href="/journal/">Назад</a>

{% endblock %}
